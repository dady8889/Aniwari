@using Aniwari.BL.Repositories;
@using Aniwari.BL.Services;

@inject ISettingsService SettingsService
@inject IAnimeRepository AnimeRepository

<input type="checkbox" class="btn-watch" checked="@watching" @onclick:stopPropagation="true" @onchange="(e) => OnValueChanged((bool?)e.Value ?? false)" />

@code {
    [Parameter] public AnimeSchedule? Anime { get; set; }

    private bool watching = false;

    private SettingsStore? Store;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        Store = SettingsService.GetStore();

        if (Anime != null)
        {
            watching = AnimeRepository.GetAnimeWatching(Anime.MalId);
        }
    }

    private async Task OnValueChanged(bool value)
    {
        if (Anime != null)
        {
            AnimeRepository.SetAnimeWatching(Anime.MalId, value);
            await SettingsService.SaveAsync();
        }
    }
}
